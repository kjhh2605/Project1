# 보안/인증 설계서

## 1. 목표
- 사용자 제출 코드 실행 환경을 안전하게 격리
- 인증/인가 체계를 단순하게 시작하고 확장 가능하게 설계

## 2. 인증/인가
### 2.1 인증
- MVP: Clerk 사용
- 토큰 검증: API Gateway 또는 백엔드 미들웨어에서 JWT 검증

### 2.2 인가
- 기본 RBAC:
  - `user`: 문제 풀이/제출/조회
  - `admin`: 문제/루브릭/운영 설정 관리
- 관리자 기능은 별도 경로 + 추가 감사로그

## 3. 샌드박스 보안
- 네트워크 차단(`network=none`)
- read-only rootfs + 제한 tmpfs
- cgroups(v2)로 CPU/메모리/PID 제한
- seccomp + AppArmor
- gVisor RuntimeClass 적용

## 4. 비밀 관리
- 환경변수 비밀값은 Secret Manager/K8s Secret 사용
- `.env.local`은 로컬 전용, 저장소 커밋 금지
- 키 회전 주기: 90일

## 5. 공급망 보안
- 이미지 스캔: Trivy (CI 필수)
- 의존성 스캔: Snyk 또는 OSV
- SBOM 생성 및 보관

## 6. 감사/로그
- 인증 이벤트(로그인/실패/권한거부) 기록
- 관리자 액션(문제 수정, 루브릭 변경) 감사로그 필수
- 로그 보존 기간: 최소 90일

## 7. 사고 대응
1. 탐지: 알람/로그 이상 감지
2. 격리: 영향 워크로드 분리
3. 복구: 롤백/패치/키 회전
4. 사후 분석: RCA + 재발 방지 액션
